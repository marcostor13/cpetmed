<app-header></app-header>


<div class="container-fluid pb-5">

    <div class="col-12 row justify-content-end mt-5">
        <button (click)="exportAllExcel()" class="btn2">Descargar Todo</button>
    </div>

    <p-messages [closable]="true"></p-messages>
    <p-confirmDialog header="ConfirmaciÃ³n" icon="pi pi-exclamation-triangle"></p-confirmDialog>

    <div class="row col-12 mt-5 m-0 p-3 filters">
        <div class="col-md-3 col-12 p-2">
            <h4 class="text-color1">FILTROS</h4>
        </div>
        <div class="col-md-3 col-12 p-2">
            <div class="row m-0 flex-column">
                <span>Desde</span>
                <p-calendar (onSelect)="getCards()" (change)="getCards()" [(ngModel)]="startDate"></p-calendar>
            </div>
        </div>
        <div class="col-md-3 col-12 p-2">
            <div class="row m-0 flex-column">
                <span>Hasta </span>
                <p-calendar (onSelect)="getCards()" [(ngModel)]="endDate"></p-calendar>
            </div>
        </div>
        <div class="col-md-3 col-12 p-2">
            <div class="row m-0 flex-column">
                <span>Empresa</span>
                <p-multiSelect defaultLabel="Seleccione una empresa" display="chip" (onChange)="getCards()" [options]="companies" [(ngModel)]="currentCompanies" optionLabel="comercialname" ></p-multiSelect>
            </div>
        </div>

        <div class="col-md-3 col-12 p-2">
            <div class="row m-0 flex-column">
                <span>Landings</span>
                <p-multiSelect defaultLabel="Seleccione una landing" display="chip" (onChange)="getCards()" [options]="landings" [(ngModel)]="currentLandings" optionLabel="name" ></p-multiSelect>
            </div>
        </div>
        <div class="col-md-3 col-12 p-2">
            <div class="row m-0 flex-column">
                <span>Listas</span>
                <p-multiSelect defaultLabel="Seleccione una lista" display="chip" (onChange)="getCards()" [options]="lists" [(ngModel)]="currentLists" optionLabel="name" ></p-multiSelect>
            </div>
        </div>
        <div class="col-md-3 col-12 p-2">
            <div class="row m-0 flex-column">
                <span>Tipo Evento</span>
                <p-multiSelect defaultLabel="Seleccione un evento" display="chip" (onChange)="getCards()" [options]="typesEvents" [(ngModel)]="currentTypesEvents"></p-multiSelect>
        
            </div>
        </div>
        <div class="col-md-3 col-12 p-2">
            <div class="row m-0 flex-column">
                <span>Tipo URL</span>
                <p-multiSelect defaultLabel="Seleccione tipo de URL" display="chip" (onChange)="getCards()" [options]="typesURLs" [(ngModel)]="currentTypeURLs"></p-multiSelect>
        
            </div>
        </div>
    </div>   
    


    <div class="container-fluid mt-5">   

        <div class="row col-12 p-0 m-0">

            <div class="col-md-3 col-12 p-2">
                <div class="bg-color1 shadow p-3 pl-5 pr-5 flex-column justify-content-center align-items-center">
                    <label class="text-white f-18 font-100">TOTAL URLS</label>
                    <h1 class="text-white">{{data?.urls?.length}}</h1>
                </div>
            </div>
            <div class="col-md-3 col-12 p-2">
                <div class="bg-color2 shadow p-3 pl-5 pr-5 flex-column justify-content-center align-items-center">
                    <label class="text-white f-18 font-100">TOTAL LISTAS</label>
                    <h1 class="text-white">{{data?.lists?.length}}</h1>
                </div>
            </div>
            <div class="col-md-3 col-12 p-2">
                <div class="bg-color8 shadow p-3 pl-5 pr-5 flex-column justify-content-center align-items-center">
                    <label class="text-white f-18 font-100">TOTAL LANDINGS</label>
                    <h1 class="text-white">{{data?.landings?.length}}</h1>
                </div>
            </div>
            <div class="col-md-3 col-12 p-2">
                <div class="bg-color5 shadow p-3 pl-5 pr-5 flex-column justify-content-center align-items-center">
                    <label class="text-white f-18 font-100">TOTAL EVENTOS</label>
                    <h1 class="text-white">{{data?.events?.length}}</h1>
                </div>
            </div>



        </div>

        <div class="row col-12 p-0 m-0 mt-5">
            <div class="col-12 col-md-4 p-2">
                <div class="row m-0 justify-content-center flex-column shadow p-5">
                    <h5 class="text-color1 font-300">TIPO DE URLS</h5>
                    <p-chart type="pie" [data]="dataChart1" [responsive]="true"></p-chart>
                </div>
            </div>
            <div class="col-12 col-md-4 p-2">
                <div class="row m-0 justify-content-center flex-column shadow p-5">
                    <h5 class="text-color1 font-300">URLS VS LISTAS</h5>
                    <p-chart type="bar" [data]="dataChart2" [responsive]="true"></p-chart>
                </div>
            </div>
            <div class="col-12 col-md-4 p-2">
                <div class="row m-0 justify-content-center flex-column shadow p-5">
                    <h5 class="text-color1 font-300">LANDINGS VS EMPRESAS</h5>
                    <p-chart type="bar" [data]="dataChart3" [responsive]="true"></p-chart>
                </div>
            </div>
        </div>

        <!-- LANDINGS -->

        <div class="row col-12 p-0 m-0 mt-5">

            <div class="col-12 p-0">
                <h5 class="text-color1">LANDINGS</h5>
                <hr>
            </div>

            <p-table 
                #dt1
                [value]="data?.landings"
                [rows]="10" 
                [showCurrentPageReport]="true"
                [globalFilterFields]="['name', '_id']"
                [paginator]="true"                
                styleClass="p-datatable-customers p-datatable-gridlines"
                [showCurrentPageReport]="true" 
                [rowsPerPageOptions]="[10,25,50]"
                dataKey="_id"
                [scrollable]="true" 
                [rows]="data?.landings?.length" 
                scrollHeight="250px"
                styleClass="p-datatable-responsive-demo"
                [responsive]="true"
            >
                <ng-template pTemplate="caption">
                    <div class="row m-0 mt-3 col-12 p-0 justify-content-between align-items-center">
                        <button pButton label="Clear" class="p-button-outlined" icon="pi pi-filter-slash" (click)="clear(dt1)"></button>
                        <div class="mt-3">
                            <button type="button" pButton pRipple icon="pi pi-file-excel" (click)="exportExcel(formatDataExcelLandings(data?.landings), 'Landings')" class="p-button-success p-mr-2 mr-3" pTooltip="XLS" tooltipPosition="bottom"></button>
                            <span class="position-relative">
                                <i class="search-icon position-absolute pi pi-search"></i>
                                <input pInputText type="text" (input)="dt1.filterGlobal($event.target.value, 'contains')" placeholder="Buscar" />
                            </span>
                        </div>
                    </div>
                </ng-template>
                <ng-template pTemplate="header">
                    <tr>
                        <th>ID</th>
                        <th>NOMBRE</th>
                        <th>EMPRESA</th>                        
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-data>
                    <tr>
                        <td class="td">{{data._id}}</td>
                        <td class="td">{{data.name}}</td>
                        <td class="td">{{getFieldByID(companies, data.companyid, 'comercialname')}}</td>                       
                    </tr>
                </ng-template>
            </p-table>

        </div>



        <!-- URLS -->

        <div class="row col-12 p-0 m-0 mt-5">

            <div class="col-12 p-0">
                <h5 class="text-color1">URLS</h5>
                <hr>
            </div>

            <p-table 
                #dt1
                [value]="data?.urls"
                [rows]="10" 
                [showCurrentPageReport]="true"
                [globalFilterFields]="['shortUrl', '_id', 'listName', 'longURL']"
                [paginator]="true"                
                styleClass="p-datatable-customers p-datatable-gridlines"
                [showCurrentPageReport]="true" 
                [rowsPerPageOptions]="[10,25,50]"
                dataKey="_id"
                [scrollable]="true" 
                [rows]="data?.urls?.length" 
                scrollHeight="250px"
                styleClass="p-datatable-responsive-demo"
                [responsive]="true"
            >
                <ng-template pTemplate="caption">
                    <div class="row m-0 mt-3 col-12 p-0 justify-content-between align-items-center">
                        <button pButton label="Clear" class="p-button-outlined" icon="pi pi-filter-slash" (click)="clear(dt1)"></button>
                        <div class="mt-3">
                            <button type="button" pButton pRipple icon="pi pi-file-excel" (click)="exportExcel(formatDataExcelURLs(data?.urls), 'Urls')" class="p-button-success p-mr-2 mr-3" pTooltip="XLS" tooltipPosition="bottom"></button>
                            <span class="position-relative">
                                <i class="search-icon position-absolute pi pi-search"></i>
                                <input pInputText type="text" (input)="dt1.filterGlobal($event.target.value, 'contains')" placeholder="Buscar" />
                            </span>
                        </div>
                    </div>
                </ng-template>
                <ng-template pTemplate="header">
                    <tr>
                        <th>ID</th>
                        <th>LISTA</th>
                        <th>URL LARGA</th>       
                        <th>URL CORTA</th>       
                        <th>TIPO</th>     
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-data>
                    <tr>
                        <td>{{data._id}}</td>
                        <td>{{data.listName}}</td>
                        <td><a href="{{data.longURL}}" target="_blank">{{data.longURL}}</a></td>
                        <td><a href="{{data.shortUrl}}" target="_blank">{{data.shortUrl}}</a></td>
                        <td>{{data.typeURL}}</td>                                        
                    </tr>
                </ng-template>
            </p-table>

        </div>



        <!-- EVENTS -->

        <div class="row col-12 p-0 m-0 mt-5">

            <div class="col-12 p-0">
                <h5 class="text-color1">EVENTOS</h5>
                <hr>
            </div>

            <p-table 
                #dt1
                [value]="data?.events"
                [rows]="10" 
                [showCurrentPageReport]="true"
                [globalFilterFields]="['shortUrl', '_id', 'listName', 'longURL']"
                [paginator]="true"                
                styleClass="p-datatable-customers p-datatable-gridlines"
                [showCurrentPageReport]="true" 
                [rowsPerPageOptions]="[10,25,50]"
                dataKey="_id"
                [scrollable]="true" 
                [rows]="data?.events?.length" 
                scrollHeight="250px"
                styleClass="p-datatable-responsive-demo"
                [responsive]="true"
            >
                <ng-template pTemplate="caption">
                    <div class="row m-0 mt-3 col-12 p-0 justify-content-between align-items-center">
                        <button pButton label="Clear" class="p-button-outlined" icon="pi pi-filter-slash" (click)="clear(dt1)"></button>
                        <div class="mt-3">
                            <button type="button" pButton pRipple icon="pi pi-file-excel" (click)="exportExcel(formatDataExcelEvents(data?.events), 'Eventos')" class="p-button-success p-mr-2 mr-3" pTooltip="XLS" tooltipPosition="bottom"></button>
                            <span class="position-relative">
                                <i class="search-icon position-absolute pi pi-search"></i>
                                <input pInputText type="text" (input)="dt1.filterGlobal($event.target.value, 'contains')" placeholder="Buscar" />
                            </span>
                        </div>
                    </div>
                </ng-template>
                <ng-template pTemplate="header">
                    <tr>
                        <th>ID</th>
                        <th>FECHA Y HORA</th>
                        <th>TIPO</th>
                        <th>LISTA</th>       
                        <th>LANDING</th>       
                        <th>URL CORTA</th>       
                        <th>URL LARGA</th>     
                        <th>DISPOSITIVO</th>     
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-data>
                    <tr>
                        <td>{{data._id}}</td>
                        <td>{{data.date | date :'dd-MMM-yy h:mm:ss a ' }}</td>
                        <ng-container [ngSwitch]="data.type">
                            <td *ngSwitchCase="'redirect'">Clic</td>
                            <td *ngSwitchCase="'visit'">Ingreso</td>
                            <td *ngSwitchCase="'send-calendar'">Calendario</td>
                            <td *ngSwitchDefault>{{data.type}}</td>
                        </ng-container>
                        <td>{{getFieldByID(lists, data.listID, 'name') }}</td>
                        <td>{{getFieldByID(landings, data.landingid, 'name') }}</td>
                        <td><a href="{{data.shortURL}}" target="_blank">{{data.shortURL}}</a></td>
                        <td><a href="{{data.url}}" target="_blank">{{data.url}}</a></td>
                        <ng-container [ngSwitch]="data.data.navigatorData.platform">
                            <td *ngSwitchCase="'Win32'">Windows</td>
                            <td *ngSwitchDefault>{{data.data.navigatorData}}</td>
                        </ng-container>                                                 
                    </tr>
                </ng-template>
            </p-table>

        </div>



    </div>



</div>

