<app-header></app-header>

<div class="container pb-5">

    <p-messages [closable]="true"></p-messages>
    <p-confirmDialog header="Confirmación" icon="pi pi-exclamation-triangle"></p-confirmDialog>

    <div class="col-12 mt-5 row m-0 justify-content-between align-items-end">

        <!-- <div class="col-12 col-md-3 justify-content-end justify-content-md-start row m-0">
            <button (click)="back()" class="btn1">Regresar</button>
        </div> -->
        <div class="row m-0 col-9 justify-content-end align-items-end">
            <div class="row m-0 col-12 col-md-3 p-0 flex-column ml-0 ml-md-2">
                <span class="ml-3 mr-3">Desde</span>
                <p-calendar styleClass="flex-1" (onSelect)="filters()" [(ngModel)]="startDate"></p-calendar>            
            </div>
            <div class="row m-0 col-12 col-md-3 p-0 flex-column ml-0 ml-md-2">
                <span class="ml-3 mr-3">Hasta </span>
                <p-calendar styleClass="flex-1" (onSelect)="filters()" [(ngModel)]="endDate"></p-calendar>
            </div>
            <div class="row m-0 col-12 col-md-3 p-0 flex-column ml-0 ml-md-2">
                <span class="ml-3 mr-3">Empresa</span>       
                <p-multiSelect  defaultLabel="Seleccione una empresa" display="chip" styleClass="flex-1" (onChange)="filters()" (onBlur)="filters()" [options]="companies" [(ngModel)]="currentCompanies" optionLabel="comercialname"></p-multiSelect>
            </div>
        </div>


    </div>

    <div class="col-12 mt-5 row m-0 justify-content-between align-items-center">
        <h5>URLS</h5>     
    </div>

    <div class="col-12 mt-5 d-flex flex-wrap">       

        <div class="col-12">
            <div>
                <button (click)="redirectCreate()" class="btn2"><i class="pi pi-plus"></i> Crear</button>
            </div>
            
            <div class="mt-3">
                <p-orderList [value]="urls" filterBy="shortUrl">
                    <ng-template let-el pTemplate="item">
                        <div class="d-flex justify-content-between pl-2 pr-2">
                            <span >{{el.listName}}</span>
                            <a target="_blank" href="{{el.shortUrl}}" >{{el.shortUrl}}</a>
                            <div>
                                <button class="view" (click)="viewURL(el)"><i class="pi pi-eye"></i></button>
                                <!-- <button class="edit" (click)="editURL(el)"><i class="pi pi-pencil"></i></button> -->
                                <button class="delete" (click)="deleteConfirmation(el._id, i)"><i class="pi pi-trash"></i></button>
                            </div>                            
                        </div>
                    </ng-template>
                </p-orderList>
            </div>

            <hr class="mt-4 border">

            <h5>Listas</h5>

            <div class="mt-3">
                <p-orderList [value]="lists" filterBy="name">
                    <ng-template let-el pTemplate="item">
                        <div class="d-flex justify-content-between pl-2 pr-2">
                            <span >{{el.name}}</span>                            
                            <div>
                                <button class="view" (click)="downloadList(el)">Descargar</button>                                
                            </div>                            
                        </div>
                    </ng-template>
                </p-orderList>
            </div>
        </div>         
    </div>

    

</div>

<p-dialog 
[header]="'URL'" 
[(visible)]="modal" 
styleClass="col-11" 
[style]="{'min-heigth': '400px'}"  
> 
    <div>
        <div *ngFor="let item of currentUrl | keyvalue" class="row justify-content-center align-items-center">
            <div class="col-6 text-color1 font-500">{{item.key | uppercase}}</div>
            <div class="col-6">{{item.value}}</div>
        </div>

        <hr />

        <label class="font-900">Parámetros</label>

        <div *ngFor="let param of currentParameters | keyvalue" class="row justify-content-center align-items-center">
            <div class="col-6 text-color1 font-500">{{param.key | uppercase}}</div>
            <div class="col-6">{{param.value}}</div>
        </div>

    </div>        
</p-dialog>